/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[21],{383:function(ha,ca,f){f.r(ca);var ba=f(2),aa=f(12),fa=f(1);ha=f(44);var ea=f(31),da=f(10);f=function(){function f(){this.init()}f.prototype.init=function(){this.S0=!1;this.bg=this.rk=this.connection=null;this.Cq={};this.ea=this.uC=null};f.prototype.Xea=function(f){for(var w=this,e=0;e<f.length;++e){var h=f[e];switch(h.at){case "create":this.Cq[h.author]||(this.Cq[h.author]=h.aName);this.K7(h);break;case "modify":this.ea.Mm(h.xfdf).then(function(e){w.ea.vb(e[0])});
break;case "delete":this.ea.Mm("<delete><id>"+h.aId+"</id></delete>")}}};f.prototype.K7=function(f){var w=this;this.ea.Mm(f.xfdf).then(function(e){e=e[0];e.authorId=f.author;w.ea.vb(e);w.ea.trigger(aa.a.UPDATE_ANNOTATION_PERMISSION,[e])})};f.prototype.m7=function(f,w,e){this.rk&&this.rk(f,w,e)};f.prototype.preloadAnnotations=function(f){this.addEventListener("webViewerServerAnnotationsEnabled",this.m7.bind(this,f,"add",{imported:!1}),{once:!0})};f.prototype.initiateCollaboration=function(x,w,e){var h=
this;if(x){h.bg=w;h.ea=e.ua();e.addEventListener(aa.c.DOCUMENT_UNLOADED,function(){h.disableCollaboration()});h.wfa(x);var r=new XMLHttpRequest;r.addEventListener("load",function(){if(200===r.status&&0<r.responseText.length)try{var e=JSON.parse(r.responseText);h.connection=exports.lb.Xfa(Object(ea.i)(h.bg,"blackbox/"),"annot");h.uC=e.id;h.Cq[e.id]=e.user_name;h.ea.aJ(e.id);h.connection.FJ(function(e){e.t&&e.t.startsWith("a_")&&e.data&&h.Xea(e.data)},function(){h.connection.send({t:"a_retrieve",dId:x});
h.trigger(f.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[h.Cq[e.id],h.uC])},function(){h.disableCollaboration()})}catch(ia){Object(fa.f)(ia.message)}});r.open("GET",Object(ea.i)(this.bg,"demo/SessionInfo.jsp"));r.withCredentials=!0;r.send();h.S0=!0;h.ea.iU(function(e){return h.Cq[e.Author]||e.Author})}else Object(fa.f)("Document ID required for collaboration")};f.prototype.disableCollaboration=function(){this.rk&&(this.ea.removeEventListener(da.a.Events.ANNOTATION_CHANGED,this.rk),this.rk=null);this.connection&&
this.connection.sF();this.ea&&this.ea.aJ("Guest");this.init();this.trigger(f.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};f.prototype.wfa=function(f){var w=this;this.rk&&this.ea.removeEventListener(da.a.Events.ANNOTATION_CHANGED,this.rk);this.rk=function(e,h,r){return Object(ba.b)(this,void 0,void 0,function(){var x,z,n,aa,da,ca,ea,fa,ha;return Object(ba.d)(this,function(y){switch(y.label){case 0:if(r.imported)return[2];x={t:"a_"+h,dId:f,annots:[]};return[4,w.ea.WO()];case 1:z=y.ia();"delete"!==
h&&(n=(new DOMParser).parseFromString(z,"text/xml"),aa=new XMLSerializer);for(da=0;da<e.length;da++)ca=e[da],fa=ea=void 0,"add"===h?(ea=n.querySelector('[name="'+ca.Id+'"]'),fa=aa.serializeToString(ea),ha=null,ca.InReplyTo&&(ha=w.ea.ug(ca.InReplyTo).authorId||"default"),x.annots.push({at:"create",aId:ca.Id,author:w.uC,aName:w.Cq[w.uC],parent:ha,xfdf:"<add>"+fa+"</add>"})):"modify"===h?(ea=n.querySelector('[name="'+ca.Id+'"]'),fa=aa.serializeToString(ea),x.annots.push({at:"modify",aId:ca.Id,xfdf:"<modify>"+
fa+"</modify>"})):"delete"===h&&x.annots.push({at:"delete",aId:ca.Id});0<x.annots.length&&w.connection.send(x);return[2]}})})}.bind(w);this.ea.addEventListener(da.a.Events.ANNOTATION_CHANGED,this.rk)};f.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return f}();Object(ha.a)(f);ca["default"]=f}}]);}).call(this || window)
